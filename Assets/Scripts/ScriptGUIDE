# Amsler Grid VR App - Script GUIDE

## Grid definition and creation: GridSpawn.cs

### Aim of the script

Generate and manage the Amsler Grid system in Unity for visualization and interaction purposes. Creates a grid of a defined number of points and lines, configures their properties and ensures a centering and visibility of the grid within the camera's view.

### Workflow of the script

1. Definition of the grid configuration parameters
2. Definition of the center fixation point parameters
3. Definition of storage for grid lines and points
4. Initialization of all grid-generation functions: CreateGridPoints(), DrawGrid(), SetupCenterFixationPoint(), SetupCamera()

### Logic behind the script: Main functions

**CreateGridPoints()**

- Definition of essential parameters for grid definition: pointsPerDimension, cellSize, halfWidth
- Definition of GridPoints GO for further collection
- Calculation of origin point of the grid *(serves as a reference point)*: located in bottom-left corner
- Iteration over row, column for creation of grid points
- Association of grid points to x-y coordinates for further use

**DrawGrid()**

- Safety check for ensuring non-duplication of lines
- Creation of GridLines GO for further collection
- Calculation of grid size and half grid with for centering of the grid around certain position
- Calculation of origin point of the grid *(serves as a reference point)*: located in bottom-left corner
- Iteration over cells (row, column) for creation of lines -> top + right-side lines
    - 1st row: draw bottom line
    - 1st column: draw left line

**SetupCenterFixationPoint()**

- Calculation of the center index for accessing the center point of the grid
- Access of the grid's center point
- Modify appearance of center point to define as center fixation dot
- Set center fixation dot as non-interactive (!isInteractable)
- Define center fixation dot as own species (isCenterFixation) and store reference

### Logic behind the script: Helper functions

**CreateLine()**

- Creation of GO for holding the LineRenderer
- Definition of LineRenderer-associated properties
- Definition of start and end positions of the lines
- Association of new line into GO

**SetupCamera()**

- Retrieving of the main camera after safety check of existance of main camera *(avoids null reference errors)*
- Centering of the main camera on the grid in both x-plane and y-plane
- Rotation of the main camera resetted to default
- Definition of the main camera projection as orthographic *(avoids distortion-associated artifacts)*
- Defines padding for the viewing of the grid with a "border"

**GridPointData (CLASS)**

- Define row, col variables
- Define isInteractable and isCenterFixation variables for identification of species
- Define deformation status isDeformed
- Define originalPosition and adjustedPosition for deformation tracking

## Displacement tracking system: DisplacementTracker.cs

### Aim of the script

Track the displacement of probe objects in the given Amsler Grid system though calculation and storage of the movement of probes from their original positions.

### Workflow of the script

1. Definition of the grid configuration parameters and of parameters for displacement data storage
2. Initialization with coroutine approach for ensuring Amsler Grid spawn and population with probe dots
3. Obtaining of references to components in the Amsler Grid
4. Computation of displacement for a probe dot
5. Computation of displacements for all probe dots
6. Obtaining of iteration snapshots

### Logic behind the script: Main functions

**InitializeTracker() (COROUTINE)**

- Coroutine approach to initialize tracking after grid has been generated
- Retrieval of GO elements from other scripts
- Set of initialization status isInitializated to true

**GetProbeDisplacement()**

- Extraction of selected probe dot and its location
- Execution of obtaining of displacement of the selected probe as difference between current and original positions
- Definition of displacement as vector in x-y planes and magnitude

**GetAllDisplacements()**

- Creation of dictionary with displacements of multiple probe dots
- Obtaining of displacement for every probe dot
- Integration of displacement for every probe dot in dictionary

**SaveIterationSnapshot()**

- Definition of snapshot variable for specific iteration
- Capturing of all current displacements for all probes in that specific iteration
- Inclusion of displacements in specific iteration

### Logic behind the script: Helper functions

**HasProbeMoved()**

- Obtaining of displacement for a specific probe dot
- Threshold-based determination of movement of specific probe dot

**GetTotalDisplacement()**

- Iteration over all displacement values for a specific probe dot
- Computation of total value as a summation of all displacements

**GetAverageDisplacement()**

- Computation of average value of displacement as the total displacement of all probes / count of probes 

**IterationDisplacementData()**

- Definition of IT number
- Definition of empty dictionary for storage of probe displacements for that IT
- Initialization of IterationDisplacementData object

**GetAllIterations()**

- Obtaining of a copy of all iteration history

**GetLatestIteration()**

- Extraction of snapshot of the [iteration-1] iteration

**ClearIterationHistory()**

- Reset of the iteration history

**GetIterationCount()**

- Exraction of count from the history of probe dots

**ResetTracker()**

- Overall reset of the displacement tracker system

## Grid definition and creation: ProbeColors.cs

### Aim of the script

Define the colors for the probe dots in the different states that the probe dot travels through during functioning of the software

### Workflow of the script

1. Definition of core colors for probe dots and their initial status (default, selected, completed)

2. Definition of higher-iteration colors for probe dots and their status (inactive~defaul)

## Grid definition and creation: FocusSystems.cs

### Aim of the script

Implementing a dynamic focus mode that allows the user to concentrate on specific areas of the Amsler Grid during testing.

### Workflow of the script

1. Definition of the grid configuration parameters
2. Definition of focus mode specific parameters
3. Definition of dictionaries for visibility and positioning of the probe dots and line segments
4. Definition of focus mode specific parameters when updated
5. Declaration of the lines segments to be defined in focus mode
6. Initialization of all grid-generation functions and safety check
7. Callback update method and safety check 
8. Definition of entering and exiting of focus mode functions
9. Displaying of area of interest around the selected probe dot
10. Creation of visual segment through portion-extraction of originally rendered lines
11. Synchronization of focus mode line segments with original ones
12. Restoring function for all lines in Amsler Grid
13. Hiding of all non-selected probe dots
14. Restoring of visibility of all probe dots in Amsler Grid
15. Extraction of probe dot's Amsler Grid index

### Logic behind the script: Main functions

**EnterFocusMode(int probeIndex)**

- Definition of focus mode status variable isInFocusMode
- Definition of selected probe dot index as currentFocusProbeIndex
- Calling of probe hiding function HideAllProbesExcept(probeIndex)
- Calling of focus area visualization function ShowFocusAreaAroundProbe(probeIndex)

**ExitFocusMode()**

- Safety check to ensure grid status = focus mode
- Re-definition of isInFocusMode to false
- Re-definition of selected probe dot index to -1
- Calling of RestoreAllLines() and RestoreProbeVisibility() for restoring of form and visualization of all Amsler Grid lines

**ShowFocusAreaAroundProbe(int probeIndex)**

- Safety checks to ensure existance of elements for focus mode definition ensure valid probe dot search
- Define selected probe index
- Safety check to ensure there is a selected probe dot

**UpdateFocusModeSegments()**

### Logic behind the script: Helper functions

**CreateLineSegment(...)**

**RestoreAllLines()**

**HideAllProbesExcept(int selectedIndex)**

**RestoreProbeVisibility()**

**GetProbeGridIndex(GameObject probe)**



